import{r as c,j as e,a as u,R as N}from"./client.js";const k="_minimized_vkebp_7",f="_icon_vkebp_53",g="_label_vkebp_61",L="_badge_vkebp_69",S="_dashboard_vkebp_87",C="_header_vkebp_123",R="_closeBtn_vkebp_167",D="_loading_vkebp_207",y="_spinner_vkebp_225",w="_spin_vkebp_225",F="_statsGrid_vkebp_255",M="_statCard_vkebp_271",P="_statValue_vkebp_299",I="_statLabel_vkebp_313",E="_section_vkebp_341",B="_emptyState_vkebp_373",V="_patternList_vkebp_389",H="_patternCard_vkebp_401",$="_selected_vkebp_429",z="_patternHeader_vkebp_441",T="_patternId_vkebp_455",O="_patternCount_vkebp_471",A="_patternRoot_vkebp_489",G="_patternFix_vkebp_491",U="_patternMeta_vkebp_513",J="_patternDetails_vkebp_527",W="_detailRow_vkebp_539",q="_detailLabel_vkebp_561",K="_detailValue_vkebp_571",Q="_fixHistory_vkebp_593",X="_fixCard_vkebp_605",Y="_fixMission_vkebp_619",Z="_fixContent_vkebp_633",ee="_fixDate_vkebp_647",te="_timeline_vkebp_661",se="_timelineItem_vkebp_673",ae="_pass_vkebp_691",ne="_fail_vkebp_701",ie="_timelineIcon_vkebp_711",le="_timelineContent_vkebp_721",re="_timelineHeader_vkebp_729",ce="_timelineMission_vkebp_743",oe="_timelineDate_vkebp_755",de="_timelineStep_vkebp_767",me="_timelineError_vkebp_779",_e="_timelineFix_vkebp_781",pe="_timelinePattern_vkebp_783",xe="_actions_vkebp_831",he="_refreshBtn_vkebp_847",ve="_exportBtn_vkebp_849",t={minimized:k,icon:f,label:g,badge:L,dashboard:S,header:C,closeBtn:R,loading:D,spinner:y,spin:w,statsGrid:F,statCard:M,statValue:P,statLabel:I,section:E,emptyState:B,patternList:V,patternCard:H,selected:$,patternHeader:z,patternId:T,patternCount:O,patternRoot:A,patternFix:G,patternMeta:U,patternDetails:J,detailRow:W,detailLabel:q,detailValue:K,fixHistory:Q,fixCard:X,fixMission:Y,fixContent:Z,fixDate:ee,timeline:te,timelineItem:se,pass:ae,fail:ne,timelineIcon:ie,timelineContent:le,timelineHeader:re,timelineMission:ce,timelineDate:oe,timelineStep:de,timelineError:me,timelineFix:_e,timelinePattern:pe,actions:xe,refreshBtn:he,exportBtn:ve},be=()=>{const[a,o]=c.useState(null),[r,m]=c.useState([]),[i,b]=c.useState(null),[j,x]=c.useState(!1);c.useEffect(()=>{_();const s=setInterval(_,5e3);return()=>clearInterval(s)},[]);const _=async()=>{try{const s=window.kodCanavari?.learningStore;if(!s){console.warn("Learning Store not available yet");return}const n=s.getStats(),l=s.loadReflections(20);o(n),m(l)}catch(s){console.error("Failed to load learning data:",s)}},p=s=>new Date(s).toLocaleString("tr-TR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),h=s=>{const n=Math.floor((Date.now()-s)/1e3/60);if(n<1)return"az önce";if(n<60)return`${n} dakika önce`;const l=Math.floor(n/60);return l<24?`${l} saat önce`:`${Math.floor(l/24)} gün önce`};return j?e.jsxs("div",{className:t.dashboard,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("h2",{children:[e.jsx("span",{className:t.icon,children:"🧠"}),"Learning Dashboard"]}),e.jsx("button",{className:t.closeBtn,onClick:()=>x(!1),children:"✕"})]}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t.statsGrid,children:[e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,children:a.totalReflections}),e.jsx("div",{className:t.statLabel,children:"Total Reflections"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,children:a.successfulFixes}),e.jsx("div",{className:t.statLabel,children:"Successful Fixes"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,children:a.totalPatterns}),e.jsx("div",{className:t.statLabel,children:"Learned Patterns"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsxs("div",{className:t.statValue,children:[a.successRate,"%"]}),e.jsx("div",{className:t.statLabel,children:"Success Rate"})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{children:"📈 Top Patterns"}),a.topPatterns.length===0?e.jsx("p",{className:t.emptyState,children:"No patterns learned yet. System will learn from FAIL→PASS cycles."}):e.jsx("div",{className:t.patternList,children:a.topPatterns.map(s=>e.jsxs("div",{className:`${t.patternCard} ${i?.id===s.id?t.selected:""}`,onClick:()=>b(s),children:[e.jsxs("div",{className:t.patternHeader,children:[e.jsx("span",{className:t.patternId,children:s.id}),e.jsxs("span",{className:t.patternCount,children:[s.count,"x"]})]}),e.jsxs("div",{className:t.patternRoot,children:[e.jsx("strong",{children:"Root Cause:"})," ",s.rootCause]}),e.jsxs("div",{className:t.patternFix,children:[e.jsx("strong",{children:"Fix:"})," ",s.fixes[0].fix]}),e.jsxs("div",{className:t.patternMeta,children:["Last seen: ",h(s.lastSeen)]})]},s.id))})]}),i&&e.jsxs("div",{className:t.section,children:[e.jsxs("h3",{children:["🔍 Pattern Details: ",i.id]}),e.jsxs("div",{className:t.patternDetails,children:[e.jsxs("div",{className:t.detailRow,children:[e.jsx("span",{className:t.detailLabel,children:"Occurrences:"}),e.jsx("span",{className:t.detailValue,children:i.count})]}),e.jsxs("div",{className:t.detailRow,children:[e.jsx("span",{className:t.detailLabel,children:"First Seen:"}),e.jsx("span",{className:t.detailValue,children:p(i.firstSeen)})]}),e.jsxs("div",{className:t.detailRow,children:[e.jsx("span",{className:t.detailLabel,children:"Last Seen:"}),e.jsx("span",{className:t.detailValue,children:p(i.lastSeen)})]}),e.jsxs("h4",{children:["📝 All Fixes (",i.fixes.length,")"]}),e.jsx("div",{className:t.fixHistory,children:i.fixes.map((s,n)=>e.jsxs("div",{className:t.fixCard,children:[e.jsx("div",{className:t.fixMission,children:s.mission}),e.jsx("div",{className:t.fixContent,children:s.fix}),e.jsx("div",{className:t.fixDate,children:p(s.timestamp)})]},n))})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("h3",{children:"⏱️ Recent Reflections"}),r.length===0?e.jsx("p",{className:t.emptyState,children:"No reflections yet."}):e.jsx("div",{className:t.timeline,children:r.map((s,n)=>e.jsxs("div",{className:`${t.timelineItem} ${t[s.result.toLowerCase()]}`,children:[e.jsx("div",{className:t.timelineIcon,children:s.result==="PASS"?"✅":"❌"}),e.jsxs("div",{className:t.timelineContent,children:[e.jsxs("div",{className:t.timelineHeader,children:[e.jsx("span",{className:t.timelineMission,children:s.mission}),e.jsx("span",{className:t.timelineDate,children:h(s.timestamp)})]}),e.jsxs("div",{className:t.timelineStep,children:[s.step," • ",s.tool]}),s.error&&e.jsxs("div",{className:t.timelineError,children:["❌ ",s.error]}),s.fix&&e.jsxs("div",{className:t.timelineFix,children:["🔧 ",s.fix]}),s.pattern&&e.jsxs("div",{className:t.timelinePattern,children:["🏷️ Pattern: ",s.pattern]})]})]},n))})]}),e.jsxs("div",{className:t.actions,children:[e.jsx("button",{className:t.refreshBtn,onClick:_,children:"🔄 Refresh"}),e.jsx("button",{className:t.exportBtn,onClick:()=>{const s=JSON.stringify({stats:a,reflections:r},null,2),n=new Blob([s],{type:"application/json"}),l=URL.createObjectURL(n),d=document.createElement("a");d.href=l,d.download=`learning-data-${Date.now()}.json`,d.click()},children:"💾 Export Data"})]})]}):e.jsxs("div",{className:t.loading,children:[e.jsx("div",{className:t.spinner}),e.jsx("p",{children:"Loading learning data..."})]})]}):e.jsxs("div",{className:t.minimized,onClick:()=>x(!0),children:[e.jsx("span",{className:t.icon,children:"🧠"}),e.jsx("span",{className:t.label,children:"Learning"}),a&&e.jsx("span",{className:t.badge,children:a.totalPatterns})]})},je=(a=5e3)=>new Promise((o,r)=>{const m=Date.now(),i=()=>{window.kodCanavari?.learningStore?o():Date.now()-m>a?r(new Error("Learning Store not available within timeout")):setTimeout(i,100)};i()}),v=async()=>{try{console.log("[Learning Dashboard] Waiting for Learning Store..."),await je(5e3),console.log("[Learning Dashboard] Learning Store ready, mounting React component...");const a=document.createElement("div");a.id="learning-dashboard-root",document.body.appendChild(a),u.createRoot(a).render(e.jsx(N.StrictMode,{children:e.jsx(be,{})})),console.log("[Learning Dashboard] React component mounted successfully! 📊")}catch(a){console.error("[Learning Dashboard] Failed to initialize:",a)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();
