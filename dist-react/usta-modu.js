import{r as a,j as n,c as ne,R as ae}from"./client.js";const re="modulepreload",oe=function(l){return"/"+l},H={},ie=function(t,r,v){let u=Promise.resolve();if(r&&r.length>0){let w=function(c){return Promise.all(c.map(m=>Promise.resolve(m).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),d=h?.nonce||h?.getAttribute("nonce");u=w(r.map(c=>{if(c=oe(c),c in H)return;H[c]=!0;const m=c.endsWith(".css"),i=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${i}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":re,m||(f.as="script"),f.crossOrigin="",f.href=c,d&&f.setAttribute("nonce",d),document.head.appendChild(f),m)return new Promise((b,I)=>{f.addEventListener("load",b),f.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})}))}function x(h){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=h,window.dispatchEvent(d),!d.defaultPrevented)throw h}return u.then(h=>{for(const d of h||[])d.status==="rejected"&&x(d.reason);return t().catch(x)})};class Y{constructor(){this.kodCanavari=window.kodCanavari,this.eventListeners=new Map,this.kodCanavari?console.log("✅ Legacy Runner initialized"):console.warn("⚠️ KodCanavari not found. Make sure app.js is loaded.")}isAvailable(){return!!this.kodCanavari}async executeNightOrders(t,r){if(!this.kodCanavari)throw new Error("KodCanavari not available");return this.kodCanavari.executeNightOrders(t,r)}subscribeToEvents(t,r){return this.kodCanavari?.eventBus?(this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(r),this.kodCanavari.eventBus.on(t,r),()=>{this.eventListeners.get(t)?.delete(r),this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(t,r)}):(console.warn("⚠️ EventBus not available"),()=>{})}getLearningStats(){return this.kodCanavari?.learningStore?this.kodCanavari.learningStore.getStats():null}getPhaseContext(){return this.kodCanavari?.phaseContext?this.kodCanavari.phaseContext:null}async requestApproval(t,r){if(!this.kodCanavari?.approvalSystem)throw new Error("Approval system not available");return this.kodCanavari.approvalSystem.requestApproval(t,r)}isDeveloperMode(){return this.kodCanavari?.developerMode||!1}getCurrentMission(){return this.kodCanavari?.currentMission||null}getWorkspaceRoot(){return this.kodCanavari?.workspaceRoot||null}addChatMessage(t,r){this.kodCanavari&&this.kodCanavari.addChatMessage(t,r)}emitEvent(t){if(!this.kodCanavari?.eventBus){console.warn("⚠️ EventBus not available, cannot emit event");return}this.kodCanavari.eventBus.emit(t)}destroy(){for(const[t,r]of this.eventListeners)for(const v of r)this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(t,v);this.eventListeners.clear(),console.log("✅ Legacy Runner destroyed")}}let L=null;function X(){return L||(L=new Y),L}function M(){return!!window.kodCanavari}function ce(l=5e3){return new Promise((t,r)=>{if(M()){t();return}const v=Date.now(),u=setInterval(()=>{M()?(clearInterval(u),t()):Date.now()-v>l&&(clearInterval(u),r(new Error("Timeout waiting for legacy system")))},100)})}const le=Object.freeze(Object.defineProperty({__proto__:null,LegacyRunner:Y,getLegacyRunner:X,isLegacySystemReady:M,waitForLegacySystem:ce},Symbol.toStringTag,{value:"Module"})),ue="_container_1xs9k_5",de="_dragging_1xs9k_39",he="_collapsed_1xs9k_51",fe="_expanded_1xs9k_59",pe="_header_1xs9k_69",me="_headerLeft_1xs9k_99",_e="_headerIcon_1xs9k_111",ve="_pulse_1xs9k_1",xe="_headerTitle_1xs9k_121",ke="_headerStatus_1xs9k_135",ge="_headerButtons_1xs9k_149",Ce="_button_1xs9k_159",ye="_collapseButton_1xs9k_181",be="_clearButton_1xs9k_197",Ee="_messagesContainer_1xs9k_215",Ne="_emptyState_1xs9k_233",we="_message_1xs9k_215",Ie="_slideIn_1xs9k_1",Re="_before_1xs9k_261",Se="_after_1xs9k_271",je="_verify_1xs9k_281",Le="_faded_1xs9k_291",Me="_messageHeader_1xs9k_299",Be="_stepId_1xs9k_311",Te="_timestamp_1xs9k_325",$e="_beforeContent_1xs9k_335",Ae="_rationale_1xs9k_355",Pe="_afterContent_1xs9k_371",De="_success_1xs9k_387",Ue="_error_1xs9k_395",Ge="_output_1xs9k_403",Fe="_verifyContent_1xs9k_423",Oe="_probeResult_1xs9k_435",He="_pass_1xs9k_451",Ve="_fail_1xs9k_459",Ye="_skip_1xs9k_467",Xe="_footer_1xs9k_475",s={container:ue,dragging:de,collapsed:he,expanded:fe,header:pe,headerLeft:me,headerIcon:_e,pulse:ve,headerTitle:xe,headerStatus:ke,headerButtons:ge,button:Ce,collapseButton:ye,clearButton:be,messagesContainer:Ee,emptyState:Ne,message:we,slideIn:Ie,before:Re,after:Se,verify:je,faded:Le,messageHeader:Me,stepId:Be,timestamp:Te,beforeContent:$e,rationale:Ae,afterContent:Pe,success:De,error:Ue,output:Ge,verifyContent:Fe,probeResult:Oe,pass:He,fail:Ve,skip:Ye,footer:Xe},ze=({maxMessages:l=50,dedupWindowMs:t=2e3,rateLimit:r=100})=>{const[v,u]=a.useState("PLANNING"),[x,h]=a.useState([]),[d,w]=a.useState(!1),[c,m]=a.useState(null),[i,f]=a.useState(!1),[b,I]=a.useState({x:window.innerWidth-470,y:20}),[C,B]=a.useState(!1),[R,z]=a.useState({x:0,y:0}),E=a.useRef(new Map),T=a.useRef(0),$=a.useRef([]),A=a.useRef(null),P=a.useRef(null),D=a.useCallback(e=>`${e.stepId}-${e.phase}-${e.goal?.substring(0,50)}`,[]),k=a.useCallback(()=>{const e=Date.now();return e-T.current<r?!1:(T.current=e,!0)},[r]),U=a.useCallback(()=>{A.current?.scrollIntoView({behavior:"smooth"})},[]),g=a.useCallback(e=>{const o=D(e),_=E.current.get(o)||0,p=Date.now();if(p-_<t){console.log("[UstaModu] Dedupe skipped:",o);return}E.current.set(o,p),h(y=>{const N=[...y,e];return N.length>l?N.slice(N.length-l):N}),setTimeout(U,50)},[D,t,l,U]),G=a.useCallback(e=>{!k()||!e.data||(u("PLANNING"),m(e.data.stepId),g({stepId:e.data.stepId,phase:"before",goal:e.data.explain?.goal,rationale:e.data.explain?.rationale,timestamp:new Date(e.timestamp)}))},[k,g]),F=a.useCallback(e=>{!k()||!e.data||(u("EXECUTING"),g({stepId:e.data.stepId,phase:"after",success:!0,output:e.data.summary,timestamp:new Date(e.timestamp)}))},[k,g]),O=a.useCallback(e=>{!k()||!e.data||(u("VERIFYING"),g({stepId:e.data.stepId,phase:"verify",results:e.data.probes,timestamp:new Date(e.timestamp)}),setTimeout(()=>u("REFLECTING"),500),setTimeout(()=>{u("PLANNING"),m(null)},1500))},[k,g]),q=a.useCallback(e=>{if(e.target.closest(".header")){B(!0);const o=P.current?.getBoundingClientRect();o&&z({x:e.clientX-o.left,y:e.clientY-o.top})}},[]),S=a.useCallback(e=>{if(C){const o=Math.max(0,Math.min(window.innerWidth-450,e.clientX-R.x)),_=Math.max(0,Math.min(window.innerHeight-100,e.clientY-R.y));I({x:o,y:_})}},[C,R]),j=a.useCallback(()=>{B(!1)},[]),K=a.useCallback(()=>{f(e=>!e)},[]);a.useEffect(()=>{const e=X(),o=e.subscribeToEvents("NARRATION_BEFORE",G),_=e.subscribeToEvents("NARRATION_AFTER",F),p=e.subscribeToEvents("NARRATION_VERIFY",O);return $.current=[o,_,p],console.log("[UstaModu] React component mounted, event listeners registered"),w(!0),()=>{$.current.forEach(y=>y()),console.log("[UstaModu] React component unmounted, cleanup complete")}},[G,F,O]),a.useEffect(()=>{if(C)return document.addEventListener("mousemove",S),document.addEventListener("mouseup",j),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",j)}},[C,S,j]),a.useEffect(()=>{const e=setInterval(()=>{const o=Date.now();E.current.forEach((_,p)=>{o-_>t*2&&E.current.delete(p)})},5e3);return()=>clearInterval(e)},[t]);const W=()=>{switch(v){case"PLANNING":return"#3b82f6";case"EXECUTING":return"#f59e0b";case"VERIFYING":return"#8b5cf6";case"REFLECTING":return"#10b981";default:return"#6b7280"}},J=()=>{switch(v){case"PLANNING":return"📋 Planlama";case"EXECUTING":return"⚡ Çalıştırma";case"VERIFYING":return"🔍 Doğrulama";case"REFLECTING":return"💡 Yansıma";default:return"⏸️ Beklemede"}},Q=e=>e.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Z=e=>{switch(e){case"before":return"🎯";case"after":return"⚡";case"verify":return"🔍";default:return"📝"}};if(!d)return null;const ee=`${s.container} ${C?s.dragging:""} ${i?s.collapsed:s.expanded}`,te=`${s.header} ${i?s.collapsed:""}`,se={"--state-color":W(),"--pos-x":`${b.x}px`,"--pos-y":`${b.y}px`};return n.jsxs("div",{ref:P,className:ee,onMouseDown:q,style:se,children:[n.jsxs("div",{className:te,children:[n.jsxs("div",{className:s.headerLeft,children:[n.jsx("span",{className:s.headerIcon,children:"🎓"}),!i&&n.jsxs("div",{children:[n.jsx("h3",{className:s.headerTitle,children:"Usta Modu"}),n.jsx("p",{className:s.headerStatus,children:J()})]})]}),n.jsxs("div",{className:s.headerButtons,children:[n.jsx("button",{type:"button",onClick:K,className:`${s.button} ${s.collapseButton}`,title:i?"Genişlet":"Küçült",children:i?"📖":"📕"}),!i&&n.jsx("button",{type:"button",onClick:()=>h([]),className:`${s.button} ${s.clearButton}`,children:"🗑️ Temizle"})]})]}),!i&&n.jsxs("div",{className:s.messagesContainer,children:[x.length===0?n.jsx("div",{className:s.emptyState,children:"Henüz bir aktivite yok... 🌙"}):x.map((e,o)=>{const _=`${s.message} ${s[e.phase]} ${o===x.length-1?"":s.faded}`;return n.jsxs("div",{className:_,children:[n.jsxs("div",{className:s.messageHeader,children:[n.jsx("span",{className:s.stepId,children:e.stepId}),n.jsx("span",{className:s.timestamp,children:Q(e.timestamp)})]}),e.phase==="before"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:s.beforeContent,children:[Z("before")," ",e.goal||"Adım planlanıyor..."]}),e.rationale&&n.jsxs("div",{className:s.rationale,children:["💭 ",e.rationale]})]}),e.phase==="after"&&n.jsxs("div",{className:`${s.afterContent} ${e.success?s.success:s.error}`,children:[e.success?"✅":"❌",n.jsx("span",{children:e.success?"Başarılı":"Hata"}),e.output&&n.jsx("span",{className:s.output,children:e.output})]}),e.phase==="verify"&&e.results&&n.jsx("div",{className:s.verifyContent,children:e.results.map((p,y)=>n.jsxs("span",{className:`${s.probeResult} ${s[p.status]}`,children:[p.type,": ",p.status.toUpperCase()]},y))})]},`${e.stepId}-${o}`)}),n.jsx("div",{ref:A})]}),!i&&n.jsxs("div",{className:s.footer,children:[n.jsxs("span",{children:["📊 Mesaj: ",x.length,"/",l]}),c&&n.jsxs("span",{children:["🎯 Aktif: ",c]}),n.jsxs("span",{children:["⚡ Rate: ",r,"ms"]})]})]})},V=async()=>{const{waitForLegacySystem:l}=await ie(async()=>{const{waitForLegacySystem:t}=await Promise.resolve().then(()=>le);return{waitForLegacySystem:t}},void 0);try{await l(5e3),console.log("[UstaModu Entry] Legacy system ready, mounting React component...");const t=document.createElement("div");t.id="usta-modu-react-root",document.body.appendChild(t),ne.createRoot(t).render(n.jsx(ae.StrictMode,{children:n.jsx(ze,{maxMessages:50,dedupWindowMs:2e3,rateLimit:100})})),console.log("[UstaModu Entry] React component mounted successfully! 🎓")}catch(t){console.error("[UstaModu Entry] Failed to initialize:",t)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",V):V();
