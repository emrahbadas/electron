import{r as s,j as t,c as ce,R as ie}from"./client.js";const le="modulepreload",de=function(u){return"/"+u},z={},ue=function(a,r,v){let h=Promise.resolve();if(r&&r.length>0){let j=function(i){return Promise.all(i.map(_=>Promise.resolve(_).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),p=g?.nonce||g?.getAttribute("nonce");h=j(r.map(i=>{if(i=de(i),i in z)return;z[i]=!0;const _=i.endsWith(".css"),c=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${c}`))return;const m=document.createElement("link");if(m.rel=_?"stylesheet":le,_||(m.as="script"),m.crossOrigin="",m.href=i,p&&m.setAttribute("nonce",p),document.head.appendChild(m),_)return new Promise((b,k)=>{m.addEventListener("load",b),m.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${i}`)))})}))}function w(g){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=g,window.dispatchEvent(p),!p.defaultPrevented)throw g}return h.then(g=>{for(const p of g||[])p.status==="rejected"&&w(p.reason);return a().catch(w)})};class K{constructor(){this.kodCanavari=window.kodCanavari,this.eventListeners=new Map,this.kodCanavari?console.log("✅ Legacy Runner initialized"):console.warn("⚠️ KodCanavari not found. Make sure app.js is loaded.")}isAvailable(){return!!this.kodCanavari}async executeNightOrders(a,r){if(!this.kodCanavari)throw new Error("KodCanavari not available");return this.kodCanavari.executeNightOrders(a,r)}subscribeToEvents(a,r){return this.kodCanavari?.eventBus?(this.eventListeners.has(a)||this.eventListeners.set(a,new Set),this.eventListeners.get(a).add(r),this.kodCanavari.eventBus.on(a,r),()=>{this.eventListeners.get(a)?.delete(r),this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(a,r)}):(console.warn("⚠️ EventBus not available"),()=>{})}getLearningStats(){return this.kodCanavari?.learningStore?this.kodCanavari.learningStore.getStats():null}getPhaseContext(){return this.kodCanavari?.phaseContext?this.kodCanavari.phaseContext:null}async requestApproval(a,r){if(!this.kodCanavari?.approvalSystem)throw new Error("Approval system not available");return this.kodCanavari.approvalSystem.requestApproval(a,r)}isDeveloperMode(){return this.kodCanavari?.developerMode||!1}getCurrentMission(){return this.kodCanavari?.currentMission||null}getWorkspaceRoot(){return this.kodCanavari?.workspaceRoot||null}addChatMessage(a,r){this.kodCanavari&&this.kodCanavari.addChatMessage(a,r)}emitEvent(a){if(!this.kodCanavari?.eventBus){console.warn("⚠️ EventBus not available, cannot emit event");return}this.kodCanavari.eventBus.emit(a)}destroy(){for(const[a,r]of this.eventListeners)for(const v of r)this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(a,v);this.eventListeners.clear(),console.log("✅ Legacy Runner destroyed")}}let L=null;function q(){return L||(L=new K),L}function B(){return!!window.kodCanavari}function he(u=5e3){return new Promise((a,r)=>{if(B()){a();return}const v=Date.now(),h=setInterval(()=>{B()?(clearInterval(h),a()):Date.now()-v>u&&(clearInterval(h),r(new Error("Timeout waiting for legacy system")))},100)})}const pe=Object.freeze(Object.defineProperty({__proto__:null,LegacyRunner:K,getLegacyRunner:q,isLegacySystemReady:B,waitForLegacySystem:he},Symbol.toStringTag,{value:"Module"})),ge="_container_w5g1n_5",me="_dragging_w5g1n_39",fe="_collapsed_w5g1n_51",_e="_expanded_w5g1n_59",ve="_header_w5g1n_69",we="_headerLeft_w5g1n_99",Ce="_headerIcon_w5g1n_111",ye="_pulse_w5g1n_1",xe="_headerTitle_w5g1n_121",be="_headerStatus_w5g1n_135",Ne="_headerButtons_w5g1n_149",Ee="_button_w5g1n_159",Me="_collapseButton_w5g1n_181",je="_clearButton_w5g1n_197",ke="_messagesContainer_w5g1n_215",Ie="_emptyState_w5g1n_233",Re="_message_w5g1n_215",Se="_slideIn_w5g1n_1",Le="_before_w5g1n_261",Be="_after_w5g1n_271",$e="_verify_w5g1n_281",Pe="_faded_w5g1n_291",Te="_messageHeader_w5g1n_299",Ae="_stepId_w5g1n_311",De="_timestamp_w5g1n_325",Ue="_beforeContent_w5g1n_335",Ge="_rationale_w5g1n_355",Oe="_afterContent_w5g1n_371",Fe="_success_w5g1n_387",He="_error_w5g1n_395",Ve="_output_w5g1n_403",Ye="_verifyContent_w5g1n_423",ze="_probeResult_w5g1n_435",Xe="_pass_w5g1n_451",Ke="_fail_w5g1n_459",qe="_skip_w5g1n_467",Je="_footer_w5g1n_475",We="_teachingCard_w5g1n_585",Qe="_teachingHeader_w5g1n_605",Ze="_conceptBadge_w5g1n_623",et="_complexityBadge_w5g1n_645",tt="_teachingExplanation_w5g1n_663",nt="_bestPractices_w5g1n_677",at="_antipatterns_w5g1n_729",st="_relatedConcepts_w5g1n_781",rt="_learnMore_w5g1n_805",n={container:ge,dragging:me,collapsed:fe,expanded:_e,header:ve,headerLeft:we,headerIcon:Ce,pulse:ye,headerTitle:xe,headerStatus:be,headerButtons:Ne,button:Ee,collapseButton:Me,clearButton:je,messagesContainer:ke,emptyState:Ie,message:Re,slideIn:Se,before:Le,after:Be,verify:$e,faded:Pe,messageHeader:Te,stepId:Ae,timestamp:De,beforeContent:Ue,rationale:Ge,afterContent:Oe,success:Fe,error:He,output:Ve,verifyContent:Ye,probeResult:ze,pass:Xe,fail:Ke,skip:qe,footer:Je,teachingCard:We,teachingHeader:Qe,conceptBadge:Ze,complexityBadge:et,teachingExplanation:tt,bestPractices:nt,antipatterns:at,relatedConcepts:st,learnMore:rt},ot=({maxMessages:u=50,dedupWindowMs:a=2e3,rateLimit:r=120})=>{const[v,h]=s.useState("PLANNING"),[w,g]=s.useState([]),[p,j]=s.useState(!1),[i,_]=s.useState(null),[c,m]=s.useState(!1),[b,k]=s.useState({x:window.innerWidth-470,y:20}),[x,$]=s.useState(!1),[I,J]=s.useState({x:0,y:0}),N=s.useRef(new Map),P=s.useRef(0),T=s.useRef([]),A=s.useRef(null),D=s.useRef(null),U=s.useRef(new Map),E=s.useCallback(e=>{const o={g:e.goal||"",r:e.rationale||"",o:e.output||"",res:e.results?e.results.map(l=>`${l.type}:${l.status}`).join("|"):"",tm:e.teachingMoment?JSON.stringify(e.teachingMoment):""};return JSON.stringify(o)},[]),G=s.useCallback(e=>{const o=E(e);return`${e.stepId}-${e.phase}-${o}`},[E]),C=s.useCallback(()=>{const e=Date.now();return e-P.current<r?!1:(P.current=e,!0)},[r]),O=s.useCallback(()=>{A.current?.scrollIntoView({behavior:"smooth"})},[]),y=s.useCallback(e=>{const o=G(e),l=Date.now(),d=N.current.get(o)||0;if(l-d<a)return;const f=`${e.stepId}|${e.phase}`,Y=E(e);U.current.get(f)!==Y&&(U.current.set(f,Y),N.current.set(o,l),g(oe=>{const M=[...oe,e];return M.length>u?M.slice(M.length-u):M}),setTimeout(O,50))},[G,E,a,u,O]),F=s.useCallback(e=>{!C()||!e.data||(h("PLANNING"),_(e.data.stepId),y({stepId:e.data.stepId,phase:"before",goal:e.data.explain?.goal,rationale:e.data.explain?.rationale,teachingMoment:e.data.explain?.teachingMoment,timestamp:new Date(e.timestamp)}))},[C,y]),H=s.useCallback(e=>{!C()||!e.data||(h("EXECUTING"),y({stepId:e.data.stepId,phase:"after",success:!0,output:e.data.summary,timestamp:new Date(e.timestamp)}))},[C,y]),V=s.useCallback(e=>{!C()||!e.data||(h("VERIFYING"),y({stepId:e.data.stepId,phase:"verify",results:e.data.probes,timestamp:new Date(e.timestamp)}),setTimeout(()=>h("REFLECTING"),500),setTimeout(()=>{h("PLANNING"),_(null)},1500))},[C,y]),W=s.useCallback(e=>{if(e.target.closest(".header")){$(!0);const o=D.current?.getBoundingClientRect();o&&J({x:e.clientX-o.left,y:e.clientY-o.top})}},[]),R=s.useCallback(e=>{if(x){const o=Math.max(0,Math.min(window.innerWidth-450,e.clientX-I.x)),l=Math.max(0,Math.min(window.innerHeight-100,e.clientY-I.y));k({x:o,y:l})}},[x,I]),S=s.useCallback(()=>{$(!1)},[]),Q=s.useCallback(()=>{m(e=>!e)},[]);s.useEffect(()=>{const e=q(),o=e.subscribeToEvents("NARRATION_BEFORE",F),l=e.subscribeToEvents("NARRATION_AFTER",H),d=e.subscribeToEvents("NARRATION_VERIFY",V);return T.current=[o,l,d],console.log("[UstaModu] React component mounted, event listeners registered"),j(!0),()=>{T.current.forEach(f=>f()),console.log("[UstaModu] React component unmounted, cleanup complete")}},[F,H,V]),s.useEffect(()=>{if(x)return document.addEventListener("mousemove",R),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",S)}},[x,R,S]),s.useEffect(()=>{const e=setInterval(()=>{const o=Date.now();N.current.forEach((l,d)=>{o-l>a*2&&N.current.delete(d)})},5e3);return()=>clearInterval(e)},[a]);const Z=()=>{switch(v){case"PLANNING":return"#3b82f6";case"EXECUTING":return"#f59e0b";case"VERIFYING":return"#8b5cf6";case"REFLECTING":return"#10b981";default:return"#6b7280"}},ee=()=>{switch(v){case"PLANNING":return"📋 Planlama";case"EXECUTING":return"⚡ Çalıştırma";case"VERIFYING":return"🔍 Doğrulama";case"REFLECTING":return"💡 Yansıma";default:return"⏸️ Beklemede"}},te=e=>e.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),ne=e=>{switch(e){case"before":return"🎯";case"after":return"⚡";case"verify":return"🔍";default:return"📝"}};if(!p)return null;const ae=`${n.container} ${x?n.dragging:""} ${c?n.collapsed:n.expanded}`,se=`${n.header} ${c?n.collapsed:""}`,re={"--state-color":Z(),"--pos-x":`${b.x}px`,"--pos-y":`${b.y}px`};return t.jsxs("div",{ref:D,className:ae,onMouseDown:W,style:re,children:[t.jsxs("div",{className:se,children:[t.jsxs("div",{className:n.headerLeft,children:[t.jsx("span",{className:n.headerIcon,children:"🎓"}),!c&&t.jsxs("div",{children:[t.jsx("h3",{className:n.headerTitle,children:"Usta Modu"}),t.jsx("p",{className:n.headerStatus,children:ee()})]})]}),t.jsxs("div",{className:n.headerButtons,children:[t.jsx("button",{type:"button",onClick:Q,className:`${n.button} ${n.collapseButton}`,title:c?"Genişlet":"Küçült",children:c?"📖":"📕"}),!c&&t.jsx("button",{type:"button",onClick:()=>g([]),className:`${n.button} ${n.clearButton}`,children:"🗑️ Temizle"})]})]}),!c&&t.jsxs("div",{className:n.messagesContainer,children:[w.length===0?t.jsx("div",{className:n.emptyState,children:"Henüz bir aktivite yok... 🌙"}):w.map((e,o)=>{const l=`${n.message} ${n[e.phase]} ${o===w.length-1?"":n.faded}`;return t.jsxs("div",{className:l,children:[t.jsxs("div",{className:n.messageHeader,children:[t.jsx("span",{className:n.stepId,children:e.stepId}),t.jsx("span",{className:n.timestamp,children:te(e.timestamp)})]}),e.phase==="before"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:n.beforeContent,children:[ne("before")," ",e.goal||"Adım planlanıyor..."]}),e.rationale&&t.jsxs("div",{className:n.rationale,children:["💭 ",e.rationale]}),e.teachingMoment&&t.jsxs("div",{className:n.teachingCard,children:[t.jsxs("div",{className:n.teachingHeader,children:[t.jsxs("span",{className:n.conceptBadge,children:["💡 ",e.teachingMoment.concept]}),t.jsxs("span",{className:n.complexityBadge,children:[e.teachingMoment.complexity==="basic"&&"🟢",e.teachingMoment.complexity==="intermediate"&&"🟡",e.teachingMoment.complexity==="advanced"&&"🔴"," ",e.teachingMoment.complexity]})]}),e.teachingMoment.explanation&&t.jsx("p",{className:n.teachingExplanation,children:e.teachingMoment.explanation}),e.teachingMoment.bestPractices&&e.teachingMoment.bestPractices.length>0&&t.jsxs("div",{className:n.bestPractices,children:[t.jsx("strong",{children:"✅ En İyi Uygulamalar:"}),t.jsx("ul",{children:e.teachingMoment.bestPractices.map((d,f)=>t.jsx("li",{children:d},f))})]}),e.teachingMoment.commonMistakes&&e.teachingMoment.commonMistakes.length>0&&t.jsxs("div",{className:n.antipatterns,children:[t.jsx("strong",{children:"⚠️ Kaçınılması Gerekenler:"}),t.jsx("ul",{children:e.teachingMoment.commonMistakes.map((d,f)=>t.jsx("li",{children:d},f))})]}),e.teachingMoment.relatedConcepts&&e.teachingMoment.relatedConcepts.length>0&&t.jsxs("div",{className:n.relatedConcepts,children:["🔗 ",t.jsx("strong",{children:"İlgili Konular:"})," ",e.teachingMoment.relatedConcepts.join(", ")]}),e.teachingMoment.learnMoreUrl&&t.jsx("a",{href:e.teachingMoment.learnMoreUrl,target:"_blank",rel:"noopener noreferrer",className:n.learnMore,children:"📚 Daha fazla öğren →"})]})]}),e.phase==="after"&&t.jsxs("div",{className:`${n.afterContent} ${e.success?n.success:n.error}`,children:[e.success?"✅":"❌",t.jsx("span",{children:e.success?"Başarılı":"Hata"}),e.output&&t.jsx("span",{className:n.output,children:e.output})]}),e.phase==="verify"&&e.results&&t.jsx("div",{className:n.verifyContent,children:e.results.map((d,f)=>t.jsxs("span",{className:`${n.probeResult} ${n[d.status]}`,children:[d.type,": ",d.status.toUpperCase()]},f))})]},`${e.stepId}-${o}`)}),t.jsx("div",{ref:A})]}),!c&&t.jsxs("div",{className:n.footer,children:[t.jsxs("span",{children:["📊 Mesaj: ",w.length,"/",u]}),i&&t.jsxs("span",{children:["🎯 Aktif: ",i]}),t.jsxs("span",{children:["⚡ Rate: ",r,"ms"]})]})]})},X=async()=>{const{waitForLegacySystem:u}=await ue(async()=>{const{waitForLegacySystem:a}=await Promise.resolve().then(()=>pe);return{waitForLegacySystem:a}},void 0);try{await u(5e3),console.log("[UstaModu Entry] Legacy system ready, mounting React component...");const a=document.createElement("div");a.id="usta-modu-react-root",document.body.appendChild(a),ce.createRoot(a).render(t.jsx(ie.StrictMode,{children:t.jsx(ot,{maxMessages:50,dedupWindowMs:2e3,rateLimit:100})})),console.log("[UstaModu Entry] React component mounted successfully! 🎓")}catch(a){console.error("[UstaModu Entry] Failed to initialize:",a)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",X):X();
