import{r as a,j as t,c as ae,R as se}from"./client.js";class oe{constructor(){this.kodCanavari=window.kodCanavari,this.eventListeners=new Map,this.kodCanavari?console.log("✅ Legacy Runner initialized"):console.warn("⚠️ KodCanavari not found. Make sure app.js is loaded.")}isAvailable(){return!!this.kodCanavari}async executeNightOrders(s,r){if(!this.kodCanavari)throw new Error("KodCanavari not available");return this.kodCanavari.executeNightOrders(s,r)}subscribeToEvents(s,r){return this.kodCanavari?.eventBus?(this.eventListeners.has(s)||this.eventListeners.set(s,new Set),this.eventListeners.get(s).add(r),this.kodCanavari.eventBus.on(s,r),()=>{this.eventListeners.get(s)?.delete(r),this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(s,r)}):(console.warn("⚠️ EventBus not available"),()=>{})}getLearningStats(){return this.kodCanavari?.learningStore?this.kodCanavari.learningStore.getStats():null}getPhaseContext(){return this.kodCanavari?.phaseContext?this.kodCanavari.phaseContext:null}async requestApproval(s,r){if(!this.kodCanavari?.approvalSystem)throw new Error("Approval system not available");return this.kodCanavari.approvalSystem.requestApproval(s,r)}isDeveloperMode(){return this.kodCanavari?.developerMode||!1}getCurrentMission(){return this.kodCanavari?.currentMission||null}getWorkspaceRoot(){return this.kodCanavari?.workspaceRoot||null}addChatMessage(s,r){this.kodCanavari&&this.kodCanavari.addChatMessage(s,r)}emitEvent(s){if(!this.kodCanavari?.eventBus){console.warn("⚠️ EventBus not available, cannot emit event");return}this.kodCanavari.eventBus.emit(s)}destroy(){for(const[s,r]of this.eventListeners)for(const p of r)this.kodCanavari?.eventBus&&this.kodCanavari.eventBus.off(s,p);this.eventListeners.clear(),console.log("✅ Legacy Runner destroyed")}}let N=null;function re(){return N||(N=new oe),N}const ce="_container_w5g1n_5",ie="_dragging_w5g1n_39",le="_collapsed_w5g1n_51",de="_expanded_w5g1n_59",ue="_header_w5g1n_69",he="_headerLeft_w5g1n_99",pe="_headerIcon_w5g1n_111",ge="_pulse_w5g1n_1",me="_headerTitle_w5g1n_121",_e="_headerStatus_w5g1n_135",fe="_headerButtons_w5g1n_149",ve="_button_w5g1n_159",we="_collapseButton_w5g1n_181",Ce="_clearButton_w5g1n_197",xe="_messagesContainer_w5g1n_215",ye="_emptyState_w5g1n_233",be="_message_w5g1n_215",Ne="_slideIn_w5g1n_1",Me="_before_w5g1n_261",Ee="_after_w5g1n_271",ke="_verify_w5g1n_281",je="_faded_w5g1n_291",Ie="_messageHeader_w5g1n_299",Re="_stepId_w5g1n_311",Se="_timestamp_w5g1n_325",Be="_beforeContent_w5g1n_335",Le="_rationale_w5g1n_355",$e="_afterContent_w5g1n_371",Te="_success_w5g1n_387",De="_error_w5g1n_395",Ae="_output_w5g1n_403",Pe="_verifyContent_w5g1n_423",Ue="_probeResult_w5g1n_435",Ge="_pass_w5g1n_451",He="_fail_w5g1n_459",Fe="_skip_w5g1n_467",Oe="_footer_w5g1n_475",Ve="_teachingCard_w5g1n_585",Ye="_teachingHeader_w5g1n_605",Xe="_conceptBadge_w5g1n_623",ze="_complexityBadge_w5g1n_645",Ke="_teachingExplanation_w5g1n_663",qe="_bestPractices_w5g1n_677",Je="_antipatterns_w5g1n_729",We="_relatedConcepts_w5g1n_781",Qe="_learnMore_w5g1n_805",n={container:ce,dragging:ie,collapsed:le,expanded:de,header:ue,headerLeft:he,headerIcon:pe,pulse:ge,headerTitle:me,headerStatus:_e,headerButtons:fe,button:ve,collapseButton:we,clearButton:Ce,messagesContainer:xe,emptyState:ye,message:be,slideIn:Ne,before:Me,after:Ee,verify:ke,faded:je,messageHeader:Ie,stepId:Re,timestamp:Se,beforeContent:Be,rationale:Le,afterContent:$e,success:Te,error:De,output:Ae,verifyContent:Pe,probeResult:Ue,pass:Ge,fail:He,skip:Fe,footer:Oe,teachingCard:Ve,teachingHeader:Ye,conceptBadge:Xe,complexityBadge:ze,teachingExplanation:Ke,bestPractices:qe,antipatterns:Je,relatedConcepts:We,learnMore:Qe},Ze=({maxMessages:c=50,dedupWindowMs:s=2e3,rateLimit:r=120})=>{const[p,u]=a.useState("PLANNING"),[f,M]=a.useState([]),[F,O]=a.useState(!1),[E,k]=a.useState(null),[h,V]=a.useState(!1),[j,Y]=a.useState({x:window.innerWidth-470,y:20}),[_,I]=a.useState(!1),[x,X]=a.useState({x:0,y:0}),v=a.useRef(new Map),R=a.useRef(0),S=a.useRef([]),B=a.useRef(null),L=a.useRef(null),$=a.useRef(new Map),w=a.useCallback(e=>{const o={g:e.goal||"",r:e.rationale||"",o:e.output||"",res:e.results?e.results.map(i=>`${i.type}:${i.status}`).join("|"):"",tm:e.teachingMoment?JSON.stringify(e.teachingMoment):""};return JSON.stringify(o)},[]),T=a.useCallback(e=>{const o=w(e);return`${e.stepId}-${e.phase}-${o}`},[w]),g=a.useCallback(()=>{const e=Date.now();return e-R.current<r?!1:(R.current=e,!0)},[r]),D=a.useCallback(()=>{B.current?.scrollIntoView({behavior:"smooth"})},[]),m=a.useCallback(e=>{const o=T(e),i=Date.now(),l=v.current.get(o)||0;if(i-l<s)return;const d=`${e.stepId}|${e.phase}`,G=w(e);$.current.get(d)!==G&&($.current.set(d,G),v.current.set(o,i),M(ne=>{const C=[...ne,e];return C.length>c?C.slice(C.length-c):C}),setTimeout(D,50))},[T,w,s,c,D]),A=a.useCallback(e=>{!g()||!e.data||(u("PLANNING"),k(e.data.stepId),m({stepId:e.data.stepId,phase:"before",goal:e.data.explain?.goal,rationale:e.data.explain?.rationale,teachingMoment:e.data.explain?.teachingMoment,timestamp:new Date(e.timestamp)}))},[g,m]),P=a.useCallback(e=>{!g()||!e.data||(u("EXECUTING"),m({stepId:e.data.stepId,phase:"after",success:!0,output:e.data.summary,timestamp:new Date(e.timestamp)}))},[g,m]),U=a.useCallback(e=>{!g()||!e.data||(u("VERIFYING"),m({stepId:e.data.stepId,phase:"verify",results:e.data.probes,timestamp:new Date(e.timestamp)}),setTimeout(()=>u("REFLECTING"),500),setTimeout(()=>{u("PLANNING"),k(null)},1500))},[g,m]),z=a.useCallback(e=>{if(e.target.closest(".header")){I(!0);const o=L.current?.getBoundingClientRect();o&&X({x:e.clientX-o.left,y:e.clientY-o.top})}},[]),y=a.useCallback(e=>{if(_){const o=Math.max(0,Math.min(window.innerWidth-450,e.clientX-x.x)),i=Math.max(0,Math.min(window.innerHeight-100,e.clientY-x.y));Y({x:o,y:i})}},[_,x]),b=a.useCallback(()=>{I(!1)},[]),K=a.useCallback(()=>{V(e=>!e)},[]);a.useEffect(()=>{const e=re(),o=e.subscribeToEvents("NARRATION_BEFORE",A),i=e.subscribeToEvents("NARRATION_AFTER",P),l=e.subscribeToEvents("NARRATION_VERIFY",U);return S.current=[o,i,l],console.log("[UstaModu] React component mounted, event listeners registered"),O(!0),()=>{S.current.forEach(d=>d()),console.log("[UstaModu] React component unmounted, cleanup complete")}},[A,P,U]),a.useEffect(()=>{if(_)return document.addEventListener("mousemove",y),document.addEventListener("mouseup",b),()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b)}},[_,y,b]),a.useEffect(()=>{const e=setInterval(()=>{const o=Date.now();v.current.forEach((i,l)=>{o-i>s*2&&v.current.delete(l)})},5e3);return()=>clearInterval(e)},[s]);const q=()=>{switch(p){case"PLANNING":return"#3b82f6";case"EXECUTING":return"#f59e0b";case"VERIFYING":return"#8b5cf6";case"REFLECTING":return"#10b981";default:return"#6b7280"}},J=()=>{switch(p){case"PLANNING":return"📋 Planlama";case"EXECUTING":return"⚡ Çalıştırma";case"VERIFYING":return"🔍 Doğrulama";case"REFLECTING":return"💡 Yansıma";default:return"⏸️ Beklemede"}},W=e=>e.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Q=e=>{switch(e){case"before":return"🎯";case"after":return"⚡";case"verify":return"🔍";default:return"📝"}};if(!F)return null;const Z=`${n.container} ${_?n.dragging:""} ${h?n.collapsed:n.expanded}`,ee=`${n.header} ${h?n.collapsed:""}`,te={"--state-color":q(),"--pos-x":`${j.x}px`,"--pos-y":`${j.y}px`};return t.jsxs("div",{ref:L,className:Z,onMouseDown:z,style:te,children:[t.jsxs("div",{className:ee,children:[t.jsxs("div",{className:n.headerLeft,children:[t.jsx("span",{className:n.headerIcon,children:"🎓"}),!h&&t.jsxs("div",{children:[t.jsx("h3",{className:n.headerTitle,children:"Usta Modu"}),t.jsx("p",{className:n.headerStatus,children:J()})]})]}),t.jsxs("div",{className:n.headerButtons,children:[t.jsx("button",{type:"button",onClick:K,className:`${n.button} ${n.collapseButton}`,title:h?"Genişlet":"Küçült",children:h?"📖":"📕"}),!h&&t.jsx("button",{type:"button",onClick:()=>M([]),className:`${n.button} ${n.clearButton}`,children:"🗑️ Temizle"})]})]}),!h&&t.jsxs("div",{className:n.messagesContainer,children:[f.length===0?t.jsx("div",{className:n.emptyState,children:"Henüz bir aktivite yok... 🌙"}):f.map((e,o)=>{const i=`${n.message} ${n[e.phase]} ${o===f.length-1?"":n.faded}`;return t.jsxs("div",{className:i,children:[t.jsxs("div",{className:n.messageHeader,children:[t.jsx("span",{className:n.stepId,children:e.stepId}),t.jsx("span",{className:n.timestamp,children:W(e.timestamp)})]}),e.phase==="before"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:n.beforeContent,children:[Q("before")," ",e.goal||"Adım planlanıyor..."]}),e.rationale&&t.jsxs("div",{className:n.rationale,children:["💭 ",e.rationale]}),e.teachingMoment&&t.jsxs("div",{className:n.teachingCard,children:[t.jsxs("div",{className:n.teachingHeader,children:[t.jsxs("span",{className:n.conceptBadge,children:["💡 ",e.teachingMoment.concept]}),t.jsxs("span",{className:n.complexityBadge,children:[e.teachingMoment.complexity==="basic"&&"🟢",e.teachingMoment.complexity==="intermediate"&&"🟡",e.teachingMoment.complexity==="advanced"&&"🔴"," ",e.teachingMoment.complexity]})]}),e.teachingMoment.explanation&&t.jsx("p",{className:n.teachingExplanation,children:e.teachingMoment.explanation}),e.teachingMoment.bestPractices&&e.teachingMoment.bestPractices.length>0&&t.jsxs("div",{className:n.bestPractices,children:[t.jsx("strong",{children:"✅ En İyi Uygulamalar:"}),t.jsx("ul",{children:e.teachingMoment.bestPractices.map((l,d)=>t.jsx("li",{children:l},d))})]}),e.teachingMoment.commonMistakes&&e.teachingMoment.commonMistakes.length>0&&t.jsxs("div",{className:n.antipatterns,children:[t.jsx("strong",{children:"⚠️ Kaçınılması Gerekenler:"}),t.jsx("ul",{children:e.teachingMoment.commonMistakes.map((l,d)=>t.jsx("li",{children:l},d))})]}),e.teachingMoment.relatedConcepts&&e.teachingMoment.relatedConcepts.length>0&&t.jsxs("div",{className:n.relatedConcepts,children:["🔗 ",t.jsx("strong",{children:"İlgili Konular:"})," ",e.teachingMoment.relatedConcepts.join(", ")]}),e.teachingMoment.learnMoreUrl&&t.jsx("a",{href:e.teachingMoment.learnMoreUrl,target:"_blank",rel:"noopener noreferrer",className:n.learnMore,children:"📚 Daha fazla öğren →"})]})]}),e.phase==="after"&&t.jsxs("div",{className:`${n.afterContent} ${e.success?n.success:n.error}`,children:[e.success?"✅":"❌",t.jsx("span",{children:e.success?"Başarılı":"Hata"}),e.output&&t.jsx("span",{className:n.output,children:e.output})]}),e.phase==="verify"&&e.results&&t.jsx("div",{className:n.verifyContent,children:e.results.map((l,d)=>t.jsxs("span",{className:`${n.probeResult} ${n[l.status]}`,children:[l.type,": ",l.status.toUpperCase()]},d))})]},`${e.stepId}-${o}`)}),t.jsx("div",{ref:B})]}),!h&&t.jsxs("div",{className:n.footer,children:[t.jsxs("span",{children:["📊 Mesaj: ",f.length,"/",c]}),E&&t.jsxs("span",{children:["🎯 Aktif: ",E]}),t.jsxs("span",{children:["⚡ Rate: ",r,"ms"]})]})]})},et=(c=5e3)=>new Promise((s,r)=>{const p=Date.now(),u=()=>{if(typeof window<"u"&&window.kodCanavari){console.log("[UstaModu Entry] window.kodCanavari found"),s();return}if(Date.now()-p>c){r(new Error(`Legacy system not ready after ${c}ms`));return}setTimeout(u,100)};u()}),H=async()=>{try{console.log("[UstaModu Entry] Waiting for legacy system..."),await et(5e3),console.log("[UstaModu Entry] Legacy system ready, mounting React component...");let c=document.getElementById("usta-modu-root");c||(console.warn("[UstaModu Entry] #usta-modu-root not found, creating fallback container"),c=document.createElement("div"),c.id="usta-modu-root",document.body.appendChild(c)),ae.createRoot(c).render(t.jsx(se.StrictMode,{children:t.jsx(Ze,{maxMessages:50,dedupWindowMs:2e3,rateLimit:100})})),console.log("[UstaModu Entry] React component mounted successfully! 🎓")}catch(c){console.error("[UstaModu Entry] Failed to initialize:",c)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",H):H();
